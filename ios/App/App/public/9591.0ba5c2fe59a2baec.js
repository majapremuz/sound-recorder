"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9591],{9591:(H,p,a)=>{a.r(p),a.d(p,{HomePageModule:()=>w});var u=a(7829),c=a(888),y=a(7222),d=a(3308),m=a(172),t=a(4303),C=a(2256),M=a(7645),k=a(65),R=a(1701);const T=["waveCanvas"],O=(n,s)=>({recording:n,idle:s});let h=(()=>{var n;class s{constructor(e,o,i,r,g,P){this.dataCtrl=e,this.androidPermissions=o,this.http=i,this.toastController=r,this.router=g,this.ngZone=P,this.audioChunks=[],this.isRecording=!1,this.timeStamp="00:00",this.recordingStartTime=null,this.audioPlayer=new Audio,this.isPlaying=!1,this.currentTime=0,this.duration=0,this.progress=0,this.audioUrl=null,this.message="",this.translate=[],this.contents=[],this.initTranslate()}ionViewWillEnter(){this.dataCtrl.setHomePage(!0),this.initPush()}ionViewWillLeave(){this.dataCtrl.setHomePage(!1)}requestAudioPermission(){var e=this;return(0,d.A)(function*(){const o=yield e.androidPermissions.checkPermission(e.androidPermissions.PERMISSION.RECORD_AUDIO);if(console.log("Audio permission result:",o),!o.hasPermission){const i=yield e.androidPermissions.requestPermission(e.androidPermissions.PERMISSION.RECORD_AUDIO);return console.log("Audio permission granted:",i),i.hasPermission}return!0})()}startRecording(){var e=this;return(0,d.A)(function*(){if(!e.isRecording)if(yield e.requestAudioPermission())try{const i=yield navigator.mediaDevices.getUserMedia({audio:!0});e.mediaRecorder=new MediaRecorder(i),e.audioChunks=[],e.autoStopTimeout&&(clearTimeout(e.autoStopTimeout),e.autoStopTimeout=null),e.mediaRecorder.ondataavailable=r=>{r.data.size>0&&e.audioChunks.push(r.data)},e.mediaRecorder.onstop=(0,d.A)(function*(){e.audioChunks.length&&(e.recordedBlob=new Blob(e.audioChunks,{type:e.mediaRecorder.mimeType||"audio/webm"}),e.ngZone.run(()=>{e.audioUrl=URL.createObjectURL(e.recordedBlob)}),yield e.sendRecording(),e.audioChunks=[],e.mediaRecorder=null)}),e.mediaRecorder.start(),e.isRecording=!0,e.recordingStartTime=Date.now(),e.timerInterval=setInterval(()=>e.updateTimer(),100),e.autoStopTimeout=setTimeout(()=>{e.isRecording&&e.stopRecording()},15e3)}catch(i){console.error("Microphone permission denied:",i),alert("Microphone access is required.")}else alert("Microphone permission is required.")})()}stopRecording(){this.isRecording&&(this.autoStopTimeout&&(clearTimeout(this.autoStopTimeout),this.autoStopTimeout=null),this.mediaRecorder.stop(),this.isRecording=!1,clearInterval(this.timerInterval),this.timeStamp="00:00")}toggleRecording(){this.isRecording?this.stopRecording():this.startRecording()}sendRecording(){var e=this;return(0,d.A)(function*(){if(e.recordedBlob)try{const o=`${Date.now()}.webm`;console.log("Uploading file:",o);let i=yield e.blobToBase64(e.recordedBlob);if("string"==typeof i){const b=i.indexOf(",");-1!==b&&(i=i.substring(b+1))}const r=localStorage.getItem("pushToken");r||console.warn("No device token found \u2013 push may not work");const g=yield e.http.post("https://traffic-call.com/api/files.php",{filedata:i,filename:o,token:r,title:"Nova poruka",body:"Dobili ste novu audio poruku",data:{audioUrl:`https://traffic-call.com/files/${o}`}}).toPromise();console.log("Full response from server:",g),yield(yield e.toastController.create({message:"Audio poslan!",duration:2e3,color:"success"})).present()}catch(o){console.error("Failed to send audio:",o),yield(yield e.toastController.create({message:"Slanje audio poruke nije uspjelo",duration:2e3,color:"danger"})).present()}})()}blobToBase64(e){return new Promise((o,i)=>{const r=new FileReader;r.onloadend=()=>o(r.result),r.onerror=i,r.readAsDataURL(e)})}initPush(){var e=this;return(0,d.A)(function*(){let o=yield m.h.checkPermissions();"granted"!==o.receive&&(o=yield m.h.requestPermissions()),"granted"===o.receive&&(yield m.h.register()),m.h.addListener("registration",function(){var i=(0,d.A)(function*(r){console.log("Device FCM token:",r.value),localStorage.setItem("pushToken",r.value),console.log("Push token saved locally.",r.value),yield e.http.post("https://traffic-call.com/api/token.php",{token:r.value}).toPromise()});return function(r){return i.apply(this,arguments)}}()),m.h.addListener("pushNotificationReceived",i=>{console.log("Push received in foreground:",i)}),m.h.addListener("pushNotificationActionPerformed",i=>{var r;console.log("Notification action:",i);const g=null===(r=i.notification.data)||void 0===r?void 0:r.audioUrl;g&&e.router.navigate(["/popis"],{queryParams:{url:g}})})})()}updateTimer(){if(!this.recordingStartTime)return;const e=Date.now()-this.recordingStartTime;if(e>=15e3)this.timeStamp="00:15",clearInterval(this.timerInterval);else{const o=Math.floor(e/1e3),i=Math.floor(e%1e3/100);this.timeStamp=`00:${o<10?"0"+o:o}.${i}`}}togglePlay(){this.isPlaying?this.audioPlayer.pause():this.audioPlayer.play(),this.isPlaying=!this.isPlaying}seekAudio(e){this.audioPlayer.currentTime=e.detail.value/100*this.duration}navigateTo(e){this.router.navigate([`/${e}`])}initTranslate(){var e=this;return(0,d.A)(function*(){e.translate.test_string=yield e.dataCtrl.translateWord("TEST.STRING")})()}}return(n=s).\u0275fac=function(e){return new(e||n)(t.rXU(C.e),t.rXU(M.K),t.rXU(k.Qq),t.rXU(c.K_),t.rXU(R.Ix),t.rXU(t.SKi))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-home"]],viewQuery:function(e,o){if(1&e&&t.GBs(T,5),2&e){let i;t.mGM(i=t.lsd())&&(o.waveCanvas=i.first)}},decls:21,vars:5,consts:[[1,"img-container",3,"click","ngClass"],["src","assets/play-icon.png","alt","audio icon",1,"mic-img"],[1,"footer-button","home-button",3,"click"],[1,"footer-btn-container"],["src","assets/home.png","alt","home icon",1,"footer-icon"],[1,"footer-button","list-button",3,"click"],["src","assets/list.png","alt","list icon",1,"footer-icon"],[1,"footer-button",3,"click"],["src","assets/profil.png","alt","profil icon",1,"footer-icon"]],template:function(e,o){1&e&&(t.j41(0,"ion-content")(1,"div",0),t.bIt("click",function(){return o.toggleRecording()}),t.nrm(2,"img",1),t.k0s(),t.j41(3,"h2"),t.EFF(4),t.k0s(),t.j41(5,"ion-footer")(6,"ion-button",2),t.bIt("click",function(){return o.navigateTo("home")}),t.j41(7,"div",3),t.nrm(8,"img",4),t.j41(9,"p"),t.EFF(10,"Po\u010detni ekran"),t.k0s()()(),t.j41(11,"ion-button",5),t.bIt("click",function(){return o.navigateTo("popis")}),t.j41(12,"div",3),t.nrm(13,"img",6),t.j41(14,"p"),t.EFF(15,"Popis objava"),t.k0s()()(),t.j41(16,"ion-button",7),t.bIt("click",function(){return o.navigateTo("profil")}),t.j41(17,"div",3),t.nrm(18,"img",8),t.j41(19,"p"),t.EFF(20,"Korisni\u010dki profil"),t.k0s()()()()()),2&e&&(t.R7$(),t.Y8G("ngClass",t.l_i(2,O,o.isRecording,!o.isRecording)),t.R7$(3),t.JRh(o.timeStamp))},dependencies:[u.MD,u.YU,c.bv,c.Jm,c.W9,c.M0],styles:["ion-content[_ngcontent-%COMP%]{padding:0;margin:0;overflow:hidden}.idle[_ngcontent-%COMP%]{background:radial-gradient(circle at 50% 50%,#fff 51%,#ff0400);transition:background .3s ease-in-out}.recording[_ngcontent-%COMP%]{background:radial-gradient(circle,#fff 50%,#2beb00);background-repeat:no-repeat;background-position:center;background-size:100% 100%;animation:_ngcontent-%COMP%_pulseGradient 2s infinite ease-in-out}@keyframes _ngcontent-%COMP%_pulseGradient{0%,to{background-size:115% 115%}50%{background-size:100% 100%}}.record-button[_ngcontent-%COMP%], .send-button[_ngcontent-%COMP%]{width:100%;height:3rem;--background: #ff0479;--color: #ffffff;font-size:1.2rem}.img-container[_ngcontent-%COMP%]{position:absolute;top:30%;left:50%;transform:translate(-50%,-50%);border:5px solid #9b9a9a;border-radius:50%;height:80vmin;width:80vmin;padding:1rem;display:flex;justify-content:center;align-items:center;overflow:hidden}.mic-img[_ngcontent-%COMP%]{height:50vmin;width:50vmin;filter:invert(54%) sepia(11%) saturate(13%) hue-rotate(316deg) brightness(98%) contrast(81%);position:relative;z-index:2}h2[_ngcontent-%COMP%]{text-align:center;padding:1rem 0;margin-top:30rem}ion-footer[_ngcontent-%COMP%]{box-shadow:none;border-top:2px solid #cacaca;padding:1rem 0;position:absolute;bottom:0;left:0;right:0;display:flex;justify-content:center;align-items:center}.footer-btn-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;flex-direction:column;padding:.5rem}.footer-button[_ngcontent-%COMP%]{--background: transparent;--box-shadow: none;margin:0}.home-button[_ngcontent-%COMP%], .list-button[_ngcontent-%COMP%]{border-right:2px solid #cacaca}.footer-icon[_ngcontent-%COMP%]{height:10vmin}p[_ngcontent-%COMP%]{font-family:Open Sans,sans-serif;color:#000;font-size:.7rem;text-transform:none}"]}),s})();var v=a(7569),f=a(656);const I=[{path:"",component:h}];let S=(()=>{var n;class s{}return(n=s).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=f.G2t({imports:[v.iI.forChild(I),v.iI]}),s})();var x=a(2882);let j=(()=>{var n;class s{constructor(){this.text="",this.type="",this.class="info",this.icon="information-circle-outline"}ngOnInit(){this.getClass()}getClass(){"success"==this.type?(this.class="success",this.icon="checkmark-circle-outline"):"warning"==this.type?(this.class="alert",this.icon="information-circle-outline"):"danger"==this.type?(this.class="danger",this.icon="alert-circle-outline"):(this.class="success",this.icon="information-circle-outline")}}return(n=s).\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-info"]],inputs:{text:"text",type:"type"},decls:9,vars:3,consts:[[1,"ion-no-margin","info-item",3,"ngClass"],[1,"ion-no-padding"],["size","auto"],[1,"icon_cover"],["size","large",3,"name"],[1,"text-container"]],template:function(e,o){1&e&&(t.j41(0,"div",0)(1,"ion-grid",1)(2,"ion-row")(3,"ion-col",2)(4,"div",3),t.nrm(5,"ion-icon",4),t.k0s()(),t.j41(6,"ion-col",5),t.EFF(7),t.k0s()()(),t.nrm(8,"ion-text"),t.k0s()),2&e&&(t.Y8G("ngClass",o.class),t.R7$(5),t.Y8G("name",o.icon),t.R7$(2),t.SpI(" ",o.text," "))},dependencies:[u.MD,u.YU,c.bv,c.hU,c.lO,c.iq,c.ln,c.IO],styles:[".info-item[_ngcontent-%COMP%]{border:1px solid black;border-radius:5px;padding:15px;box-shadow:2px 2px 6px #cbcbcb;margin-top:15px}.info-item.success[_ngcontent-%COMP%]{background-color:#e4ffd6}.info-item.alert[_ngcontent-%COMP%]{background-color:#fcebd6}.info-item.danger[_ngcontent-%COMP%]{background-color:#ffdada}.text-container[_ngcontent-%COMP%]{align-self:center;margin-bottom:5px}.icon_cover[_ngcontent-%COMP%]{width:40px}"]}),s})(),U=(()=>{var n;class s{}return(n=s).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=f.G2t({imports:[c.bv,u.MD,j]}),s})(),w=(()=>{var n;class s{}return(n=s).\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=f.G2t({imports:[h,u.MD,y.YN,c.bv,S,x.h,U]}),s})()}}]);