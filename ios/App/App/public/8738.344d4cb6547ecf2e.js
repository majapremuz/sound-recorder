"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8738],{8738:(z,P,l)=>{l.r(P),l.d(P,{PopisPageModule:()=>E});var p=l(7829),_=l(7222),c=l(888),y=l(7569),b=l(3308),w=l(5312),M=l(2882),t=l(4303),u=l(656),C=l(65),O=l(3095);function k(o,r){1&o&&(t.j41(0,"p",11),t.EFF(1,"Nema zvukova na popisu"),t.k0s())}function x(o,r){if(1&o&&(t.j41(0,"p",23),t.EFF(1),t.k0s()),2&o){const a=t.XpG().$implicit;t.R7$(),t.JRh(a.street)}}function j(o,r){1&o&&(t.j41(0,"div",24),t.nrm(1,"ion-spinner",25),t.k0s())}function F(o,r){1&o&&(t.j41(0,"p",26),t.EFF(1,"No location available"),t.k0s())}function R(o,r){if(1&o){const a=t.RV6();t.j41(0,"ion-item",12)(1,"div",13)(2,"div",14),t.DNE(3,x,2,1,"p",15),t.nrm(4,"br"),t.j41(5,"p",16),t.EFF(6),t.k0s(),t.nrm(7,"br"),t.j41(8,"p",17),t.EFF(9),t.k0s(),t.j41(10,"p",18),t.EFF(11),t.k0s()(),t.j41(12,"ion-button",19),t.bIt("click",function(){const i=u.eBV(a).$implicit,e=t.XpG();return u.Njj(e.playAudio(i))}),t.nrm(13,"img",20),t.k0s(),t.j41(14,"div",21),t.DNE(15,j,2,0,"div",22),t.k0s(),t.DNE(16,F,2,0,"ng-template",null,0,t.C5r),t.k0s()()}if(2&o){const a=r.$implicit;t.R7$(3),t.Y8G("ngIf",a.city&&a.street),t.R7$(3),t.JRh(a.city),t.R7$(3),t.JRh(a.time),t.R7$(2),t.JRh(a.date),t.R7$(2),t.Y8G("src",a.isPlaying?"assets/pause-icon.png":"assets/microphone.png",t.B4B),t.R7$(),t.AVh("visible",a.showMap),t.Y8G("id",a.mapId),t.R7$(),t.Y8G("ngIf",a.isLoading)}}let v=(()=>{var o;class r{constructor(n,i,e){this.http=n,this.router=i,this.ngZone=e,this.audios=[],this.audioPlayer=new Audio,this.currentAudio=null}ngOnInit(){this.loadAudios(),this.audioPlayer.addEventListener("ended",()=>{this.currentAudio&&this.ngZone.run(()=>{console.log("Audio ended:",this.currentAudio.name),this.currentAudio.isPlaying=!1,this.currentAudio=null})})}onViewDidEnter(){this.audios.length>0&&setTimeout(()=>{this.audios.forEach(n=>{n.showMap&&this.initMap(n)})},400)}loadAudios(){var n=this;return(0,b.A)(function*(){try{const i=yield n.http.get("https://traffic-call.com/api/filelist.php").toPromise();if(console.log("Raw response from server:",i),Array.isArray(i)){if(n.audios=i.map((e,s)=>{const[d,g]=(e.title||"").split(" ");let m="";if(d){const h=new Date(d);m=`${String(h.getDate()).padStart(2,"0")}.${String(h.getMonth()+1).padStart(2,"0")}.${h.getFullYear()}`}const f=g?g.slice(0,5):"";return{name:e.title||e.filename,url:e.filename,latitude:e.latitude,longitude:e.longitude,mapId:`map-${s}`,isPlaying:!1,showMap:!1,city:e.city,street:e.street,date:m,time:f}}),setTimeout(()=>{n.audios.forEach(e=>{e.showMap&&n.initMap(e)})},300),n.audios.length>0){const e=n.audios[0];console.log("Auto-playing first audio:",e.name),e.showMap=!0,setTimeout(()=>n.initMap(e),500),setTimeout(()=>{try{n.playAudio(e)}catch(s){console.warn("Autoplay failed (blocked by browser):",s)}},800)}}else console.warn("Unexpected response format:",i),n.audios=[]}catch(i){console.error("Failed to load audios:",i),n.audios=[]}})()}playAudio(n){if(this.currentAudio===n)return void(n.isPlaying?(this.audioPlayer.pause(),n.isPlaying=!1,n.showMap=!1):(this.audioPlayer.play().catch(s=>console.warn("Play blocked:",s)),n.isPlaying=!0,n.showMap=!0,setTimeout(()=>this.initMap(n),420)));this.currentAudio&&(this.currentAudio.isPlaying=!1,this.audioPlayer.pause(),this.audioPlayer.currentTime=0,this.currentAudio.showMap=!1),this.currentAudio=n,n.isPlaying=!0,n.showMap=!0;const e=new Audio("assets/jingle.wav");e.play().catch(s=>console.warn("Jingle blocked:",s)),e.addEventListener("ended",()=>{this.audioPlayer.src=`https://traffic-call.com/files/${n.url}`,this.audioPlayer.onended=null,this.audioPlayer.play().then(()=>console.log("Playing main audio:",n.name)).catch(s=>console.warn("Main audio play blocked:",s)),setTimeout(()=>this.initMap(n),420),this.audioPlayer.addEventListener("ended",()=>{this.ngZone.run(()=>{console.log("\u2705 Main audio finished:",n.name),n.isPlaying=!1,n.showMap=!1,this.currentAudio=null})},{once:!0})}),e.addEventListener("error",()=>{this.ngZone.run(()=>{console.warn("Jingle playback failed"),n.isPlaying=!1,n.showMap=!1,this.currentAudio=null})})}loadGoogleMaps(){return new Promise((n,i)=>{if(window.google&&window.google.maps)return void n();const e=document.createElement("script");e.src=`https://maps.googleapis.com/maps/api/js?key=${w.c.google_map_api}`,e.async=!0,e.defer=!0,e.onload=()=>n(),e.onerror=()=>i("Google Maps failed to load."),document.head.appendChild(e)})}initMap(n){var i=this;return(0,b.A)(function*(){const e=n.mapId;yield i.waitForElement(`#${e}`);const s=document.getElementById(e);if(!s)return;console.log("Loading Google Maps for audio:",n.name),yield i.loadGoogleMaps(),console.log("Google Maps loaded!");const d=parseFloat(n.latitude),g=parseFloat(n.longitude);if(isNaN(d)||isNaN(g))return;const m=new google.maps.Map(s,{center:{lat:d,lng:g},zoom:17,disableDefaultUI:!0}),f={url:"assets/google_map_marker.png",scaledSize:new google.maps.Size(70,50),anchor:new google.maps.Point(20,50)};new google.maps.Marker({position:{lat:d,lng:g},map:m,icon:f})})()}waitForElement(n){return new Promise(i=>{if(document.querySelector(n))return void i();const s=new MutationObserver(()=>{document.querySelector(n)&&(s.disconnect(),i())});s.observe(document.body,{childList:!0,subtree:!0})})}navigateTo(n){this.router.navigate([`/${n}`])}}return(o=r).\u0275fac=function(n){return new(n||o)(t.rXU(C.Qq),t.rXU(O.Ix),t.rXU(t.SKi))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-popis"]],decls:23,vars:12,consts:[["noLocation",""],[3,"fullscreen"],["class","no-audios",4,"ngIf"],["lines","none",4,"ngFor","ngForOf"],[1,"footer-button","home-button",3,"click"],[1,"footer-btn-container"],["src","assets/home.png","alt","home icon",1,"footer-icon"],[1,"footer-button","list-button",3,"click"],["src","assets/list.png","alt","list icon",1,"footer-icon"],[1,"footer-button",3,"click"],["src","assets/profil.png","alt","profil icon",1,"footer-icon"],[1,"no-audios"],["lines","none"],[1,"item-grid"],[1,"label-wrap"],["class","adress",4,"ngIf"],[1,"city"],[1,"time"],[1,"date"],[1,"play-button",3,"click"],[1,"play-icon",3,"src"],[1,"map",3,"id"],["class","map-loader",4,"ngIf"],[1,"adress"],[1,"map-loader"],["name","crescent"],[1,"no-location"]],template:function(n,i){1&n&&(t.j41(0,"ion-content",1)(1,"ion-list"),t.DNE(2,k,2,0,"p",2)(3,R,18,9,"ion-item",3),t.k0s()(),t.j41(4,"ion-footer")(5,"ion-button",4),t.bIt("click",function(){return i.navigateTo("home")}),t.j41(6,"div",5),t.nrm(7,"img",6),t.j41(8,"p"),t.EFF(9),t.nI1(10,"translate"),t.k0s()()(),t.j41(11,"ion-button",7),t.bIt("click",function(){return i.navigateTo("popis")}),t.j41(12,"div",5),t.nrm(13,"img",8),t.j41(14,"p"),t.EFF(15),t.nI1(16,"translate"),t.k0s()()(),t.j41(17,"ion-button",9),t.bIt("click",function(){return i.navigateTo("profil")}),t.j41(18,"div",5),t.nrm(19,"img",10),t.j41(20,"p"),t.EFF(21),t.nI1(22,"translate"),t.k0s()()()()),2&n&&(t.Y8G("fullscreen",!0),t.R7$(2),t.Y8G("ngIf",0===i.audios.length),t.R7$(),t.Y8G("ngForOf",i.audios),t.R7$(6),t.JRh(t.bMT(10,6,"HOME")),t.R7$(6),t.JRh(t.bMT(16,8,"LIST")),t.R7$(6),t.JRh(t.bMT(22,10,"PROFILE")))},dependencies:[p.MD,p.Sq,p.bT,c.bv,c.Jm,c.W9,c.M0,c.uz,c.nf,c.w2,M.h,M.D9],styles:["ion-item[_ngcontent-%COMP%]{--background: #ebebeb;width:90%;--border-radius: 8px;margin:1rem auto;gap:8px}ion-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-family:Roboto;font-size:1rem;text-align:left;vertical-align:10px;display:table-cell}.item-grid[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:1fr auto auto;grid-template-rows:auto auto;gap:8px;align-items:center;padding:.6rem;box-sizing:border-box;background:var(--ion-item-background, #ebebeb);border-radius:8px;transition:all .3s ease}.item-inner[_ngcontent-%COMP%]{padding:.3rem}.label-wrap[_ngcontent-%COMP%]{grid-column:1/2}ion-list[_ngcontent-%COMP%]{max-height:80vh;overflow-y:auto}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--min-height: unset;padding:0}.play-button[_ngcontent-%COMP%]{grid-column:3/4;justify-self:end;--background: transparent;--box-shadow: none}.play-button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:15vmin}.map-button[_ngcontent-%COMP%]{grid-column:2/3;justify-self:end;--background: transparent;--box-shadow: none}.map-button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:7vmin;filter:brightness(0) saturate(100%) invert(0%) sepia(7%) saturate(7472%) hue-rotate(6deg) brightness(97%) contrast(108%)}.no-audios[_ngcontent-%COMP%]{text-align:center;font-size:1.2rem;font-family:Roboto}ion-footer[_ngcontent-%COMP%]{box-shadow:none;background-color:#f0f0f0;height:5rem;padding:1rem 0;position:fixed;bottom:0;left:0;right:0;display:flex;justify-content:center;align-items:center}.footer-btn-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;flex-direction:column;padding:.5rem}.footer-button[_ngcontent-%COMP%]{--background: transparent;--box-shadow: none;margin:0}.home-button[_ngcontent-%COMP%], .list-button[_ngcontent-%COMP%]{border-right:2px solid #ffffff}.img-wrapper[_ngcontent-%COMP%]{width:200px;height:200px;position:relative}.play-icon[_ngcontent-%COMP%]{font-size:28px;transition:transform .2s ease,color .2s ease}.play-icon[name=play-circle][_ngcontent-%COMP%]{background:url(play-icon.9d86d7145dcea8df.png)}.play-icon[name=pause-circle][_ngcontent-%COMP%]{background:url(pause-icon.f840c7e622be5fa1.png);transform:scale(1.1)}.footer-icon[_ngcontent-%COMP%]{height:10vmin}p[_ngcontent-%COMP%]{font-family:Roboto;color:#000;font-size:.7rem;text-transform:none}.adress[_ngcontent-%COMP%], .time[_ngcontent-%COMP%]{font-weight:900}.time[_ngcontent-%COMP%]{padding-right:.2rem}.map[_ngcontent-%COMP%]{grid-column:1/-1;width:100%;height:0;opacity:0;margin-top:0;border-radius:8px;background:transparent;transition:height .4s ease,opacity .4s ease,margin-top .4s ease;position:relative;overflow:hidden;z-index:0}.map.visible[_ngcontent-%COMP%]{height:90vmin;opacity:1;margin-top:.5rem;pointer-events:auto}.map-loader[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:10;background:#fffc;border-radius:50%;width:50px;height:50px;display:flex;justify-content:center;align-items:center}.leaflet-container[_ngcontent-%COMP%]{background:#f0f0f0}.no-location[_ngcontent-%COMP%]{text-align:center;color:#777;font-size:.9rem;padding:10px 0;font-style:italic}"]}),r})();const A=[{path:"",component:v}];let T=(()=>{var o;class r{}return(o=r).\u0275fac=function(n){return new(n||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=u.G2t({imports:[y.iI.forChild(A),y.iI]}),r})(),E=(()=>{var o;class r{}return(o=r).\u0275fac=function(n){return new(n||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=u.G2t({imports:[v,p.MD,_.YN,c.bv,T]}),r})()}}]);