"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[517],{517:(E,P,s)=>{s.r(P),s.d(P,{HomePageModule:()=>$});var h=s(7829),d=s(888),M=s(7222),g=s(3308),m=s(172);const y=(0,s(2126).F3)("Geolocation",{web:()=>s.e(3243).then(s.bind(s,3243)).then(o=>new o.GeolocationWeb)});!function w(o=!1){typeof window>"u"||(window.CapacitorUtils=window.CapacitorUtils||{},void 0===window.Capacitor||o?void 0!==window.cordova&&function T(o){o.CapacitorUtils.Synapse=new Proxy({},{get:(a,c)=>o.cordova.plugins[c]})}(window):function R(o){o.CapacitorUtils.Synapse=new Proxy({},{get:(a,c)=>new Proxy({},{get:(e,n)=>(i,r,l)=>{const u=o.Capacitor.Plugins[c];void 0!==u?"function"==typeof u[n]?(0,g.A)(function*(){try{const p=yield u[n](i);r(p)}catch(p){l(p)}})():l(new Error(`Method ${n} not found in Capacitor plugin ${c}`)):l(new Error(`Capacitor plugin ${c} not found`))}})})}(window))}();var t=s(4303),S=s(2256),O=s(7645),x=s(65),I=s(1701);const U=["waveCanvas"],j=(o,a)=>({recording:o,idle:a});let C=(()=>{var o;class a{constructor(e,n,i,r,l,u){this.dataCtrl=e,this.androidPermissions=n,this.http=i,this.toastController=r,this.router=l,this.ngZone=u,this.audioChunks=[],this.isRecording=!1,this.timeStamp="00:00",this.recordingStartTime=null,this.hasSent=!1,this.audioPlayer=new Audio,this.isPlaying=!1,this.currentTime=0,this.duration=0,this.progress=0,this.audioUrl=null,this.message="",this.translate=[],this.contents=[],this.initTranslate()}ionViewWillEnter(){this.dataCtrl.setHomePage(!0),this.initPush()}ionViewWillLeave(){this.dataCtrl.setHomePage(!1)}requestAudioPermission(){var e=this;return(0,g.A)(function*(){const n=yield e.androidPermissions.checkPermission(e.androidPermissions.PERMISSION.RECORD_AUDIO);if(console.log("Audio permission result:",n),!n.hasPermission){const i=yield e.androidPermissions.requestPermission(e.androidPermissions.PERMISSION.RECORD_AUDIO);return console.log("Audio permission granted:",i),i.hasPermission}return!0})()}startRecording(){var e=this;return(0,g.A)(function*(){if(yield y.requestPermissions(),!e.isRecording)if(yield e.requestAudioPermission())try{const i=yield navigator.mediaDevices.getUserMedia({audio:!0});e.mediaRecorder=new MediaRecorder(i),e.audioChunks=[],e.hasSent=!1,e.autoStopTimeout&&(clearTimeout(e.autoStopTimeout),e.autoStopTimeout=null),e.mediaRecorder.ondataavailable=r=>{r.data.size>0&&e.audioChunks.push(r.data)},e.mediaRecorder.onstop=(0,g.A)(function*(){e.hasSent||(e.hasSent=!0,e.audioChunks.length&&(e.recordedBlob=new Blob(e.audioChunks,{type:e.mediaRecorder.mimeType||"audio/webm"}),e.ngZone.run(()=>{e.audioUrl=URL.createObjectURL(e.recordedBlob)}),yield e.sendRecording(),e.audioChunks=[],e.mediaRecorder=null))}),e.mediaRecorder.start(),e.isRecording=!0,e.recordingStartTime=Date.now(),e.timerInterval=setInterval(()=>e.updateTimer(),100),e.autoStopTimeout=setTimeout(()=>{e.isRecording&&e.stopRecording()},15e3)}catch(i){console.error("Microphone permission denied:",i),alert("Microphone access is required.")}else alert("Microphone permission is required.")})()}stopRecording(){this.isRecording&&(this.autoStopTimeout&&(clearTimeout(this.autoStopTimeout),this.autoStopTimeout=null),this.mediaRecorder&&"inactive"!==this.mediaRecorder.state&&this.mediaRecorder.stop(),this.isRecording=!1,clearInterval(this.timerInterval),this.timeStamp="00:00")}toggleRecording(){this.isRecording?this.stopRecording():this.startRecording()}sendRecording(){var e=this;return(0,g.A)(function*(){if(e.recordedBlob)try{const n=`${Date.now()}.webm`;console.log("Uploading file:",n);let i=yield e.blobToBase64(e.recordedBlob);if("string"==typeof i){const f=i.indexOf(",");-1!==f&&(i=i.substring(f+1))}let r={};try{const f=yield y.getCurrentPosition();r={latitude:f.coords.latitude,longitude:f.coords.longitude},console.log("GPS coordinates:",r)}catch(f){console.warn("Could not get GPS location:",f)}const l=localStorage.getItem("pushToken");l||console.warn("No device token found \u2013 push may not work");const u=yield e.http.post("https://traffic-call.com/api/files.php",{filedata:i,filename:n,token:l,title:"Nova poruka",body:"Dobili ste novu audio poruku",data:{audioUrl:`https://traffic-call.com/files/${n}`,latitude:r.latitude,longitude:r.longitude}}).toPromise();console.log("Full response from server:",u),yield(yield e.toastController.create({message:"Audio i lokacija poslani!",duration:2e3,color:"success"})).present()}catch(n){console.error("Failed to send audio:",n),yield(yield e.toastController.create({message:"Slanje nije uspjelo",duration:2e3,color:"danger"})).present()}})()}blobToBase64(e){return new Promise((n,i)=>{const r=new FileReader;r.onloadend=()=>n(r.result),r.onerror=i,r.readAsDataURL(e)})}initPush(){var e=this;return(0,g.A)(function*(){let n=yield m.h.checkPermissions();"granted"!==n.receive&&(n=yield m.h.requestPermissions()),"granted"===n.receive&&(yield m.h.register()),m.h.addListener("registration",function(){var r=(0,g.A)(function*(l){console.log("Device FCM token:",l.value),localStorage.setItem("pushToken",l.value),console.log("Push token saved locally:",l.value);try{yield e.http.post("https://traffic-call.com/api/token.php",{token:l.value}).toPromise()}catch(u){console.error("Failed to send token to backend:",u)}});return function(l){return r.apply(this,arguments)}}()),localStorage.getItem("pushToken")||(console.warn("No push token found, trying to re-register..."),yield m.h.register()),m.h.addListener("pushNotificationReceived",r=>{console.log("Push received in foreground:",r)}),m.h.addListener("pushNotificationActionPerformed",r=>{var l;console.log("Notification action:",r);const u=null===(l=r.notification.data)||void 0===l?void 0:l.audioUrl;u&&e.router.navigate(["/popis"],{queryParams:{url:u}})})})()}updateTimer(){if(!this.recordingStartTime)return;const e=Date.now()-this.recordingStartTime;if(e>=15e3)this.timeStamp="00:15",clearInterval(this.timerInterval);else{const n=Math.floor(e/1e3),i=Math.floor(e%1e3/100);this.timeStamp=`00:${n<10?"0"+n:n}.${i}`}}togglePlay(){this.isPlaying?this.audioPlayer.pause():this.audioPlayer.play(),this.isPlaying=!this.isPlaying}seekAudio(e){this.audioPlayer.currentTime=e.detail.value/100*this.duration}navigateTo(e){this.router.navigate([`/${e}`])}initTranslate(){var e=this;return(0,g.A)(function*(){e.translate.test_string=yield e.dataCtrl.translateWord("TEST.STRING")})()}}return(o=a).\u0275fac=function(e){return new(e||o)(t.rXU(S.e),t.rXU(O.K),t.rXU(x.Qq),t.rXU(d.K_),t.rXU(I.Ix),t.rXU(t.SKi))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-home"]],viewQuery:function(e,n){if(1&e&&t.GBs(U,5),2&e){let i;t.mGM(i=t.lsd())&&(n.waveCanvas=i.first)}},decls:21,vars:5,consts:[[1,"img-container",3,"click","ngClass"],["src","assets/play-icon.png","alt","audio icon",1,"mic-img"],[1,"footer-button","home-button",3,"click"],[1,"footer-btn-container"],["src","assets/home.png","alt","home icon",1,"footer-icon"],[1,"footer-button","list-button",3,"click"],["src","assets/list.png","alt","list icon",1,"footer-icon"],[1,"footer-button",3,"click"],["src","assets/profil.png","alt","profil icon",1,"footer-icon"]],template:function(e,n){1&e&&(t.j41(0,"ion-content")(1,"div",0),t.bIt("click",function(){return n.toggleRecording()}),t.nrm(2,"img",1),t.k0s(),t.j41(3,"h2"),t.EFF(4),t.k0s(),t.j41(5,"ion-footer")(6,"ion-button",2),t.bIt("click",function(){return n.navigateTo("home")}),t.j41(7,"div",3),t.nrm(8,"img",4),t.j41(9,"p"),t.EFF(10,"Po\u010detni ekran"),t.k0s()()(),t.j41(11,"ion-button",5),t.bIt("click",function(){return n.navigateTo("popis")}),t.j41(12,"div",3),t.nrm(13,"img",6),t.j41(14,"p"),t.EFF(15,"Popis objava"),t.k0s()()(),t.j41(16,"ion-button",7),t.bIt("click",function(){return n.navigateTo("profil")}),t.j41(17,"div",3),t.nrm(18,"img",8),t.j41(19,"p"),t.EFF(20,"Korisni\u010dki profil"),t.k0s()()()()()),2&e&&(t.R7$(),t.Y8G("ngClass",t.l_i(2,j,n.isRecording,!n.isRecording)),t.R7$(3),t.JRh(n.timeStamp))},dependencies:[h.MD,h.YU,d.bv,d.Jm,d.W9,d.M0],styles:["ion-content[_ngcontent-%COMP%]{padding:0;margin:0;overflow:hidden}.idle[_ngcontent-%COMP%]{background:radial-gradient(circle at 50% 50%,#fff 51%,#ff0400);transition:background .3s ease-in-out}.recording[_ngcontent-%COMP%]{background:radial-gradient(circle,#fff 50%,#2beb00);background-repeat:no-repeat;background-position:center;background-size:100% 100%;animation:_ngcontent-%COMP%_pulseGradient 2s infinite ease-in-out}@keyframes _ngcontent-%COMP%_pulseGradient{0%,to{background-size:115% 115%}50%{background-size:100% 100%}}.record-button[_ngcontent-%COMP%], .send-button[_ngcontent-%COMP%]{width:100%;height:3rem;--background: #ff0479;--color: #ffffff;font-size:1.2rem}.img-container[_ngcontent-%COMP%]{position:absolute;top:30%;left:50%;transform:translate(-50%,-50%);border:5px solid #9b9a9a;border-radius:50%;height:80vmin;width:80vmin;padding:1rem;display:flex;justify-content:center;align-items:center;overflow:hidden}.mic-img[_ngcontent-%COMP%]{height:50vmin;width:50vmin;filter:invert(54%) sepia(11%) saturate(13%) hue-rotate(316deg) brightness(98%) contrast(81%);position:relative;z-index:2}h2[_ngcontent-%COMP%]{text-align:center;padding:1rem 0;margin-top:120%}@media screen and (min-width: 800px){h2[_ngcontent-%COMP%]{margin-top:90%;font-size:3rem}}ion-footer[_ngcontent-%COMP%]{box-shadow:none;border-top:2px solid #cacaca;padding:1rem 0;position:absolute;bottom:0;left:0;right:0;display:flex;justify-content:center;align-items:center}.footer-btn-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;flex-direction:column;padding:.5rem}.footer-button[_ngcontent-%COMP%]{--background: transparent;--box-shadow: none;margin:0}.home-button[_ngcontent-%COMP%], .list-button[_ngcontent-%COMP%]{border-right:2px solid #cacaca}.footer-icon[_ngcontent-%COMP%]{height:10vmin}p[_ngcontent-%COMP%]{font-family:Open Sans,sans-serif;color:#000;font-size:.7rem;text-transform:none}"]}),a})();var b=s(7569),v=s(656);const F=[{path:"",component:C}];let H=(()=>{var o;class a{}return(o=a).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=v.G2t({imports:[b.iI.forChild(F),b.iI]}),a})();var A=s(2882);let G=(()=>{var o;class a{constructor(){this.text="",this.type="",this.class="info",this.icon="information-circle-outline"}ngOnInit(){this.getClass()}getClass(){"success"==this.type?(this.class="success",this.icon="checkmark-circle-outline"):"warning"==this.type?(this.class="alert",this.icon="information-circle-outline"):"danger"==this.type?(this.class="danger",this.icon="alert-circle-outline"):(this.class="success",this.icon="information-circle-outline")}}return(o=a).\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.VBU({type:o,selectors:[["app-info"]],inputs:{text:"text",type:"type"},decls:9,vars:3,consts:[[1,"ion-no-margin","info-item",3,"ngClass"],[1,"ion-no-padding"],["size","auto"],[1,"icon_cover"],["size","large",3,"name"],[1,"text-container"]],template:function(e,n){1&e&&(t.j41(0,"div",0)(1,"ion-grid",1)(2,"ion-row")(3,"ion-col",2)(4,"div",3),t.nrm(5,"ion-icon",4),t.k0s()(),t.j41(6,"ion-col",5),t.EFF(7),t.k0s()()(),t.nrm(8,"ion-text"),t.k0s()),2&e&&(t.Y8G("ngClass",n.class),t.R7$(5),t.Y8G("name",n.icon),t.R7$(2),t.SpI(" ",n.text," "))},dependencies:[h.MD,h.YU,d.bv,d.hU,d.lO,d.iq,d.ln,d.IO],styles:[".info-item[_ngcontent-%COMP%]{border:1px solid black;border-radius:5px;padding:15px;box-shadow:2px 2px 6px #cbcbcb;margin-top:15px}.info-item.success[_ngcontent-%COMP%]{background-color:#e4ffd6}.info-item.alert[_ngcontent-%COMP%]{background-color:#fcebd6}.info-item.danger[_ngcontent-%COMP%]{background-color:#ffdada}.text-container[_ngcontent-%COMP%]{align-self:center;margin-bottom:5px}.icon_cover[_ngcontent-%COMP%]{width:40px}"]}),a})(),D=(()=>{var o;class a{}return(o=a).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=v.G2t({imports:[d.bv,h.MD,G]}),a})(),$=(()=>{var o;class a{}return(o=a).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=v.G2t({imports:[C,h.MD,M.YN,d.bv,H,A.h,D]}),a})()}}]);