"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8738],{8738:(G,P,l)=>{l.r(P),l.d(P,{PopisPageModule:()=>T});var p=l(7829),v=l(7222),c=l(888),y=l(7569),b=l(3308),_=l(5312),t=l(4303),g=l(656),w=l(65),k=l(1701);function C(o,r){1&o&&(t.j41(0,"p",11),t.EFF(1,"Nema zvukova na popisu"),t.k0s())}function O(o,r){if(1&o&&(t.j41(0,"p",23),t.EFF(1),t.k0s()),2&o){const a=t.XpG().$implicit;t.R7$(),t.JRh(a.street)}}function j(o,r){1&o&&(t.j41(0,"div",24),t.nrm(1,"ion-spinner",25),t.k0s())}function x(o,r){1&o&&(t.j41(0,"p",26),t.EFF(1,"No location available"),t.k0s())}function F(o,r){if(1&o){const a=t.RV6();t.j41(0,"ion-item",12)(1,"div",13)(2,"div",14),t.DNE(3,O,2,1,"p",15),t.nrm(4,"br"),t.j41(5,"p",16),t.EFF(6),t.k0s(),t.nrm(7,"br"),t.j41(8,"p",17),t.EFF(9),t.k0s(),t.j41(10,"p",18),t.EFF(11),t.k0s()(),t.j41(12,"ion-button",19),t.bIt("click",function(){const i=g.eBV(a).$implicit,n=t.XpG();return g.Njj(n.playAudio(i))}),t.nrm(13,"img",20),t.k0s(),t.j41(14,"div",21),t.DNE(15,j,2,0,"div",22),t.k0s(),t.DNE(16,x,2,0,"ng-template",null,0,t.C5r),t.k0s()()}if(2&o){const a=r.$implicit;t.R7$(3),t.Y8G("ngIf",a.city&&a.street),t.R7$(3),t.JRh(a.city),t.R7$(3),t.JRh(a.time),t.R7$(2),t.JRh(a.date),t.R7$(2),t.Y8G("src",a.isPlaying?"assets/pause-icon.png":"assets/microphone.png",t.B4B),t.R7$(),t.AVh("visible",a.showMap),t.Y8G("id",a.mapId),t.R7$(),t.Y8G("ngIf",a.isLoading)}}let M=(()=>{var o;class r{constructor(e,i,n){this.http=e,this.router=i,this.ngZone=n,this.audios=[],this.audioPlayer=new Audio,this.currentAudio=null}ngOnInit(){this.loadAudios(),this.audioPlayer.addEventListener("ended",()=>{this.currentAudio&&this.ngZone.run(()=>{console.log("Audio ended:",this.currentAudio.name),this.currentAudio.isPlaying=!1,this.currentAudio=null})})}onViewDidEnter(){this.audios.length>0&&setTimeout(()=>{this.audios.forEach(e=>{e.showMap&&this.initMap(e)})},400)}loadAudios(){var e=this;return(0,b.A)(function*(){try{const i=yield e.http.get("https://traffic-call.com/api/filelist.php").toPromise();if(console.log("Raw response from server:",i),Array.isArray(i)){if(e.audios=i.map((n,s)=>{const[d,u]=(n.title||"").split(" ");let m="";if(d){const h=new Date(d);m=`${String(h.getDate()).padStart(2,"0")}.${String(h.getMonth()+1).padStart(2,"0")}.${h.getFullYear()}`}const f=u?u.slice(0,5):"";return{name:n.title||n.filename,url:n.filename,latitude:n.latitude,longitude:n.longitude,mapId:`map-${s}`,isPlaying:!1,showMap:!1,city:n.city,street:n.street,date:m,time:f}}),setTimeout(()=>{e.audios.forEach(n=>{n.showMap&&e.initMap(n)})},300),e.audios.length>0){const n=e.audios[0];console.log("Auto-playing first audio:",n.name),n.showMap=!0,setTimeout(()=>e.initMap(n),500),setTimeout(()=>{try{e.playAudio(n)}catch(s){console.warn("Autoplay failed (blocked by browser):",s)}},800)}}else console.warn("Unexpected response format:",i),e.audios=[]}catch(i){console.error("Failed to load audios:",i),e.audios=[]}})()}playAudio(e){if(this.currentAudio===e)return void(e.isPlaying?(this.audioPlayer.pause(),e.isPlaying=!1,e.showMap=!1):(this.audioPlayer.play().catch(s=>console.warn("Play blocked:",s)),e.isPlaying=!0,e.showMap=!0,setTimeout(()=>this.initMap(e),420)));this.currentAudio&&(this.currentAudio.isPlaying=!1,this.audioPlayer.pause(),this.audioPlayer.currentTime=0,this.currentAudio.showMap=!1),this.currentAudio=e,e.isPlaying=!0,e.showMap=!0;const n=new Audio("assets/jingle.wav");n.play().catch(s=>console.warn("Jingle blocked:",s)),n.addEventListener("ended",()=>{this.audioPlayer.src=`https://traffic-call.com/files/${e.url}`,this.audioPlayer.onended=null,this.audioPlayer.play().then(()=>console.log("Playing main audio:",e.name)).catch(s=>console.warn("Main audio play blocked:",s)),setTimeout(()=>this.initMap(e),420),this.audioPlayer.addEventListener("ended",()=>{this.ngZone.run(()=>{console.log("\u2705 Main audio finished:",e.name),e.isPlaying=!1,e.showMap=!1,this.currentAudio=null})},{once:!0})}),n.addEventListener("error",()=>{this.ngZone.run(()=>{console.warn("Jingle playback failed"),e.isPlaying=!1,e.showMap=!1,this.currentAudio=null})})}loadGoogleMaps(){return new Promise((e,i)=>{if(window.google&&window.google.maps)return void e();const n=document.createElement("script");n.src=`https://maps.googleapis.com/maps/api/js?key=${_.c.google_map_api}`,n.async=!0,n.defer=!0,n.onload=()=>e(),n.onerror=()=>i("Google Maps failed to load."),document.head.appendChild(n)})}initMap(e){var i=this;return(0,b.A)(function*(){const n=e.mapId;yield i.waitForElement(`#${n}`);const s=document.getElementById(n);if(!s)return;yield i.loadGoogleMaps();const d=parseFloat(e.latitude),u=parseFloat(e.longitude);if(isNaN(d)||isNaN(u))return;const m=new google.maps.Map(s,{center:{lat:d,lng:u},zoom:17,disableDefaultUI:!0}),f={url:"assets/google_map_marker.png",scaledSize:new google.maps.Size(70,50),anchor:new google.maps.Point(20,50)};new google.maps.Marker({position:{lat:d,lng:u},map:m,icon:f})})()}waitForElement(e){return new Promise(i=>{if(document.querySelector(e))return void i();const s=new MutationObserver(()=>{document.querySelector(e)&&(s.disconnect(),i())});s.observe(document.body,{childList:!0,subtree:!0})})}navigateTo(e){this.router.navigate([`/${e}`])}}return(o=r).\u0275fac=function(e){return new(e||o)(t.rXU(w.Qq),t.rXU(k.Ix),t.rXU(t.SKi))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-popis"]],decls:20,vars:3,consts:[["noLocation",""],[3,"fullscreen"],["class","no-audios",4,"ngIf"],["lines","none",4,"ngFor","ngForOf"],[1,"footer-button","home-button",3,"click"],[1,"footer-btn-container"],["src","assets/home.png","alt","home icon",1,"footer-icon"],[1,"footer-button","list-button",3,"click"],["src","assets/list.png","alt","list icon",1,"footer-icon"],[1,"footer-button",3,"click"],["src","assets/profil.png","alt","profil icon",1,"footer-icon"],[1,"no-audios"],["lines","none"],[1,"item-grid"],[1,"label-wrap"],["class","adress",4,"ngIf"],[1,"city"],[1,"time"],[1,"date"],[1,"play-button",3,"click"],[1,"play-icon",3,"src"],[1,"map",3,"id"],["class","map-loader",4,"ngIf"],[1,"adress"],[1,"map-loader"],["name","crescent"],[1,"no-location"]],template:function(e,i){1&e&&(t.j41(0,"ion-content",1)(1,"ion-list"),t.DNE(2,C,2,0,"p",2)(3,F,18,9,"ion-item",3),t.k0s()(),t.j41(4,"ion-footer")(5,"ion-button",4),t.bIt("click",function(){return i.navigateTo("home")}),t.j41(6,"div",5),t.nrm(7,"img",6),t.j41(8,"p"),t.EFF(9,"Po\u010detni ekran"),t.k0s()()(),t.j41(10,"ion-button",7),t.bIt("click",function(){return i.navigateTo("popis")}),t.j41(11,"div",5),t.nrm(12,"img",8),t.j41(13,"p"),t.EFF(14,"Popis objava"),t.k0s()()(),t.j41(15,"ion-button",9),t.bIt("click",function(){return i.navigateTo("profil")}),t.j41(16,"div",5),t.nrm(17,"img",10),t.j41(18,"p"),t.EFF(19,"Korisni\u010dki profil"),t.k0s()()()()),2&e&&(t.Y8G("fullscreen",!0),t.R7$(2),t.Y8G("ngIf",0===i.audios.length),t.R7$(),t.Y8G("ngForOf",i.audios))},dependencies:[p.MD,p.Sq,p.bT,c.bv,c.Jm,c.W9,c.M0,c.uz,c.nf,c.w2],styles:["ion-item[_ngcontent-%COMP%]{--background: #ebebeb;width:90%;--border-radius: 8px;margin:1rem auto;gap:8px}ion-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-family:Roboto;font-size:1rem;text-align:left;vertical-align:10px;display:table-cell}.item-grid[_ngcontent-%COMP%]{width:100%;display:grid;grid-template-columns:1fr auto auto;grid-template-rows:auto auto;gap:8px;align-items:center;padding:.6rem;box-sizing:border-box;background:var(--ion-item-background, #ebebeb);border-radius:8px;transition:all .3s ease}.item-inner[_ngcontent-%COMP%]{padding:.3rem}.label-wrap[_ngcontent-%COMP%]{grid-column:1/2}ion-list[_ngcontent-%COMP%]{max-height:80vh;overflow-y:auto}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--min-height: unset;padding:0}.play-button[_ngcontent-%COMP%]{grid-column:3/4;justify-self:end;--background: transparent;--box-shadow: none}.play-button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:15vmin}.map-button[_ngcontent-%COMP%]{grid-column:2/3;justify-self:end;--background: transparent;--box-shadow: none}.map-button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:7vmin;filter:brightness(0) saturate(100%) invert(0%) sepia(7%) saturate(7472%) hue-rotate(6deg) brightness(97%) contrast(108%)}.no-audios[_ngcontent-%COMP%]{text-align:center;font-size:1.2rem;font-family:Roboto}ion-footer[_ngcontent-%COMP%]{box-shadow:none;background-color:#f0f0f0;height:5rem;padding:1rem 0;position:fixed;bottom:0;left:0;right:0;display:flex;justify-content:center;align-items:center}.footer-btn-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;flex-direction:column;padding:.5rem}.footer-button[_ngcontent-%COMP%]{--background: transparent;--box-shadow: none;margin:0}.home-button[_ngcontent-%COMP%], .list-button[_ngcontent-%COMP%]{border-right:2px solid #ffffff}.play-icon[_ngcontent-%COMP%]{font-size:28px;transition:transform .2s ease,color .2s ease}.play-icon[name=play-circle][_ngcontent-%COMP%]{background:url(play-icon.9d86d7145dcea8df.png)}.play-icon[name=pause-circle][_ngcontent-%COMP%]{background:url(pause-icon.86c113cd1fdfed93.png);transform:scale(1.1)}.footer-icon[_ngcontent-%COMP%]{height:10vmin}p[_ngcontent-%COMP%]{font-family:Roboto;color:#000;font-size:.7rem;text-transform:none}.adress[_ngcontent-%COMP%], .time[_ngcontent-%COMP%]{font-weight:900}.time[_ngcontent-%COMP%]{padding-right:.2rem}.map[_ngcontent-%COMP%]{grid-column:1/-1;width:100%;height:0;opacity:0;margin-top:0;border-radius:8px;background:transparent;transition:height .4s ease,opacity .4s ease,margin-top .4s ease;position:relative;overflow:hidden;z-index:0}.map.visible[_ngcontent-%COMP%]{height:90vmin;opacity:1;margin-top:.5rem;pointer-events:auto}.map-loader[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:10;background:#fffc;border-radius:50%;width:50px;height:50px;display:flex;justify-content:center;align-items:center}.leaflet-container[_ngcontent-%COMP%]{background:#f0f0f0}.no-location[_ngcontent-%COMP%]{text-align:center;color:#777;font-size:.9rem;padding:10px 0;font-style:italic}"]}),r})();const A=[{path:"",component:M}];let E=(()=>{var o;class r{}return(o=r).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=g.G2t({imports:[y.iI.forChild(A),y.iI]}),r})(),T=(()=>{var o;class r{}return(o=r).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=g.G2t({imports:[M,p.MD,v.YN,c.bv,E]}),r})()}}]);