"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[517],{517:(L,M,a)=>{a.r(M),a.d(M,{HomePageModule:()=>N});var h=a(7829),u=a(888),w=a(7222),m=a(3308),p=a(172);const C=(0,a(2126).F3)("Geolocation",{web:()=>a.e(3243).then(a.bind(a,3243)).then(o=>new o.GeolocationWeb)});!function x(o=!1){typeof window>"u"||(window.CapacitorUtils=window.CapacitorUtils||{},void 0===window.Capacitor||o?void 0!==window.cordova&&function S(o){o.CapacitorUtils.Synapse=new Proxy({},{get:(c,l)=>o.cordova.plugins[l]})}(window):function O(o){o.CapacitorUtils.Synapse=new Proxy({},{get:(c,l)=>new Proxy({},{get:(e,n)=>(i,r,s)=>{const d=o.Capacitor.Plugins[l];void 0!==d?"function"==typeof d[n]?(0,m.A)(function*(){try{const g=yield d[n](i);r(g)}catch(g){s(g)}})():s(new Error(`Method ${n} not found in Capacitor plugin ${l}`)):s(new Error(`Capacitor plugin ${l} not found`))}})})}(window))}();var I=a(5312),t=a(4303),j=a(2256),U=a(7645),H=a(65),A=a(1701);const F=["waveCanvas"],G=(o,c)=>({recording:o,idle:c});let R=(()=>{var o;class c{constructor(e,n,i,r,s,d){this.dataCtrl=e,this.androidPermissions=n,this.http=i,this.toastController=r,this.router=s,this.ngZone=d,this.audioChunks=[],this.isRecording=!1,this.timeStamp="00:00",this.recordingStartTime=null,this.hasSent=!1,this.audioPlayer=new Audio,this.isPlaying=!1,this.currentTime=0,this.duration=0,this.progress=0,this.audioUrl=null,this.message="",this.translate=[],this.contents=[],this.initTranslate()}ionViewWillEnter(){this.dataCtrl.setHomePage(!0),this.initPush()}ionViewWillLeave(){this.dataCtrl.setHomePage(!1)}requestAudioPermission(){var e=this;return(0,m.A)(function*(){const n=yield e.androidPermissions.checkPermission(e.androidPermissions.PERMISSION.RECORD_AUDIO);if(console.log("Audio permission result:",n),!n.hasPermission){const i=yield e.androidPermissions.requestPermission(e.androidPermissions.PERMISSION.RECORD_AUDIO);return console.log("Audio permission granted:",i),i.hasPermission}return!0})()}startRecording(){var e=this;return(0,m.A)(function*(){if(yield C.requestPermissions(),!e.isRecording)if(yield e.requestAudioPermission())try{const i=yield navigator.mediaDevices.getUserMedia({audio:!0});e.mediaRecorder=new MediaRecorder(i),e.audioChunks=[],e.hasSent=!1,e.autoStopTimeout&&(clearTimeout(e.autoStopTimeout),e.autoStopTimeout=null),e.mediaRecorder.ondataavailable=r=>{r.data.size>0&&e.audioChunks.push(r.data)},e.mediaRecorder.onstop=(0,m.A)(function*(){e.hasSent||(e.hasSent=!0,e.audioChunks.length&&(e.recordedBlob=new Blob(e.audioChunks,{type:e.mediaRecorder.mimeType||"audio/webm"}),e.ngZone.run(()=>{e.audioUrl=URL.createObjectURL(e.recordedBlob)}),yield e.sendRecording(),e.audioChunks=[],e.mediaRecorder=null))}),e.mediaRecorder.start(),e.isRecording=!0,e.recordingStartTime=Date.now(),e.timerInterval=setInterval(()=>e.updateTimer(),100),e.autoStopTimeout=setTimeout(()=>{e.isRecording&&e.stopRecording()},15e3)}catch(i){console.error("Microphone permission denied:",i),alert("Microphone access is required.")}else alert("Microphone permission is required.")})()}stopRecording(){this.isRecording&&(this.autoStopTimeout&&(clearTimeout(this.autoStopTimeout),this.autoStopTimeout=null),this.mediaRecorder&&"inactive"!==this.mediaRecorder.state&&this.mediaRecorder.stop(),this.isRecording=!1,clearInterval(this.timerInterval),this.timeStamp="00:00")}toggleRecording(){this.isRecording?this.stopRecording():this.startRecording()}sendRecording(){var e=this;return(0,m.A)(function*(){if(e.recordedBlob)try{const n=`${Date.now()}.webm`;console.log("Uploading file:",n);let i=yield e.blobToBase64(e.recordedBlob);if("string"==typeof i){const P=i.indexOf(",");-1!==P&&(i=i.substring(P+1))}if("granted"!==(yield C.requestPermissions()).location)return void console.warn("Location permission denied");yield new Promise(P=>setTimeout(P,500));const s=yield C.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4}),d={latitude:s.coords.latitude,longitude:s.coords.longitude};console.log("GPS coordinates:",d);const g=yield e.reverseGeocode(d.latitude,d.longitude);console.log("Reverse geocode result:",g);const v=localStorage.getItem("pushToken");v||console.warn("No device token found \u2013 push may not work");const y={filedata:i,filename:n,token:v,latitude:d.latitude,longitude:d.longitude,city:g.city,street:g.street,country:g.country};console.log("Sending payload:",y);const f=yield e.http.post("https://traffic-call.com/api/files.php",y).toPromise();console.log("Full response from server:",f),yield(yield e.toastController.create({message:"Audio i lokacija poslani!",duration:2e3,color:"success"})).present(),e.ngZone.run(()=>{e.router.navigate(["/popis"])})}catch(n){console.error("Failed to send audio:",n),yield(yield e.toastController.create({message:"Slanje nije uspjelo",duration:2e3,color:"danger"})).present()}})()}blobToBase64(e){return new Promise((n,i)=>{const r=new FileReader;r.onloadend=()=>n(r.result),r.onerror=i,r.readAsDataURL(e)})}reverseGeocode(e,n){var i=this;return(0,m.A)(function*(){try{const r=`https://maps.googleapis.com/maps/api/geocode/json?latlng=${e},${n}&key=${I.c.google_map_api}&language=hr`,s=yield i.http.get(r).toPromise();if("OK"===s.status&&s.results.length>0){const d=s.results[0].address_components;let g="",v="",y="";for(const f of d)f.types.includes("locality")&&(g=f.long_name),f.types.includes("route")&&(v=f.long_name),f.types.includes("country")&&(y=f.long_name);return{city:g,street:v,country:y}}return console.warn("Geocoding failed:",s),{city:"",street:"",country:""}}catch(r){return console.error("Reverse geocoding error:",r),{city:"",street:"",country:""}}})()}initPush(){var e=this;return(0,m.A)(function*(){let n=yield p.h.checkPermissions();"granted"!==n.receive&&(n=yield p.h.requestPermissions()),"granted"===n.receive&&(yield p.h.register()),p.h.addListener("registration",function(){var r=(0,m.A)(function*(s){console.log("Device FCM token:",s.value),localStorage.setItem("pushToken",s.value),console.log("Push token saved locally:",s.value);try{yield e.http.post("https://traffic-call.com/api/token.php",{token:s.value}).toPromise()}catch(d){console.error("Failed to send token to backend:",d)}});return function(s){return r.apply(this,arguments)}}()),localStorage.getItem("pushToken")||(console.warn("No push token found, trying to re-register..."),yield p.h.register()),p.h.addListener("pushNotificationReceived",r=>{console.log("Push received in foreground:",r)}),p.h.addListener("pushNotificationActionPerformed",r=>{var s;console.log("Notification action:",r);const d=null===(s=r.notification.data)||void 0===s?void 0:s.audioUrl;d&&e.router.navigate(["/popis"],{queryParams:{url:d}})})})()}updateTimer(){if(!this.recordingStartTime)return;const e=Date.now()-this.recordingStartTime;if(e>=15e3)this.timeStamp="00:15",clearInterval(this.timerInterval);else{const n=Math.floor(e/1e3),i=Math.floor(e%1e3/100);this.timeStamp=`00:${n<10?"0"+n:n}.${i}`}}togglePlay(){this.isPlaying?this.audioPlayer.pause():this.audioPlayer.play(),this.isPlaying=!this.isPlaying}seekAudio(e){this.audioPlayer.currentTime=e.detail.value/100*this.duration}navigateTo(e){this.router.navigate([`/${e}`])}initTranslate(){var e=this;return(0,m.A)(function*(){e.translate.test_string=yield e.dataCtrl.translateWord("TEST.STRING")})()}}return(o=c).\u0275fac=function(e){return new(e||o)(t.rXU(j.e),t.rXU(U.K),t.rXU(H.Qq),t.rXU(u.K_),t.rXU(A.Ix),t.rXU(t.SKi))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-home"]],viewQuery:function(e,n){if(1&e&&t.GBs(F,5),2&e){let i;t.mGM(i=t.lsd())&&(n.waveCanvas=i.first)}},decls:24,vars:5,consts:[["src","assets/header_img.png","alt","header image"],[1,"img-container",3,"click","ngClass"],["src","assets/microphone.png","alt","audio icon",1,"mic-img"],[1,"footer-button","home-button",3,"click"],[1,"footer-btn-container"],["src","assets/home.png","alt","home icon",1,"footer-icon"],[1,"footer-button","list-button",3,"click"],["src","assets/list.png","alt","list icon",1,"footer-icon"],[1,"footer-button",3,"click"],["src","assets/profil.png","alt","profil icon",1,"footer-icon"]],template:function(e,n){1&e&&(t.j41(0,"ion-header")(1,"ion-toolbar"),t.nrm(2,"img",0),t.k0s()(),t.j41(3,"ion-content")(4,"div",1),t.bIt("click",function(){return n.toggleRecording()}),t.nrm(5,"img",2),t.k0s(),t.j41(6,"h2"),t.EFF(7),t.k0s(),t.j41(8,"ion-footer")(9,"ion-button",3),t.bIt("click",function(){return n.navigateTo("home")}),t.j41(10,"div",4),t.nrm(11,"img",5),t.j41(12,"p"),t.EFF(13,"Po\u010detni ekran"),t.k0s()()(),t.j41(14,"ion-button",6),t.bIt("click",function(){return n.navigateTo("popis")}),t.j41(15,"div",4),t.nrm(16,"img",7),t.j41(17,"p"),t.EFF(18,"Popis objava"),t.k0s()()(),t.j41(19,"ion-button",8),t.bIt("click",function(){return n.navigateTo("profil")}),t.j41(20,"div",4),t.nrm(21,"img",9),t.j41(22,"p"),t.EFF(23,"Korisni\u010dki profil"),t.k0s()()()()()),2&e&&(t.R7$(4),t.Y8G("ngClass",t.l_i(2,G,n.isRecording,!n.isRecording)),t.R7$(3),t.JRh(n.timeStamp))},dependencies:[h.MD,h.YU,u.bv,u.Jm,u.W9,u.M0,u.eU,u.ai],styles:["ion-header[_ngcontent-%COMP%]{box-shadow:none}ion-content[_ngcontent-%COMP%]{padding:0;margin:0;overflow:hidden}.idle[_ngcontent-%COMP%]{background:radial-gradient(circle at 50% 50%,#fff 51%,#00a6c8);transition:background .3s ease-in-out}.recording[_ngcontent-%COMP%]{background:radial-gradient(circle,#fff 50%,#2beb00);background-repeat:no-repeat;background-position:center;background-size:100% 100%;animation:_ngcontent-%COMP%_pulseGradient 2s infinite ease-in-out}@keyframes _ngcontent-%COMP%_pulseGradient{0%,to{background-size:115% 115%}50%{background-size:100% 100%}}.record-button[_ngcontent-%COMP%], .send-button[_ngcontent-%COMP%]{width:100%;height:3rem;--background: #ff0479;--color: #ffffff;font-size:1.2rem}.img-container[_ngcontent-%COMP%]{position:absolute;top:30%;left:50%;transform:translate(-50%,-50%);background:radial-gradient(circle at 50% 50%,#fdfdfd 50%,#e6e6e6);border:10px solid #e6e6e6;border-radius:50%;height:80vmin;width:80vmin;padding:1rem;display:flex;justify-content:center;align-items:center;overflow:hidden}.mic-img[_ngcontent-%COMP%]{width:50vmin;position:relative;z-index:2}h2[_ngcontent-%COMP%]{text-align:center;padding:1rem 0;margin-top:110vmin;font-size:2rem}@media screen and (min-width: 800px){h2[_ngcontent-%COMP%]{margin-top:10vmin;font-size:3rem}}@media screen and (min-width: 350px){h2[_ngcontent-%COMP%]{margin-top:95vmin;font-size:3rem}}ion-footer[_ngcontent-%COMP%]{box-shadow:none;background-color:#f0f0f0;height:5rem;padding:1rem 0;display:flex;justify-content:center;align-items:center;position:fixed;bottom:0;left:0;right:0}.footer-btn-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;flex-direction:column;padding:.5rem}.footer-button[_ngcontent-%COMP%]{--background: transparent;--box-shadow: none;margin:0}.home-button[_ngcontent-%COMP%], .list-button[_ngcontent-%COMP%]{border-right:2px solid #ffffff}.footer-icon[_ngcontent-%COMP%]{height:10vmin}p[_ngcontent-%COMP%]{font-family:Roboto;color:#000;font-size:.7rem;text-transform:none}"]}),c})();var k=a(7569),b=a(656);const $=[{path:"",component:R}];let D=(()=>{var o;class c{}return(o=c).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=b.G2t({imports:[k.iI.forChild($),k.iI]}),c})();var E=a(2882);let z=(()=>{var o;class c{constructor(){this.text="",this.type="",this.class="info",this.icon="information-circle-outline"}ngOnInit(){this.getClass()}getClass(){"success"==this.type?(this.class="success",this.icon="checkmark-circle-outline"):"warning"==this.type?(this.class="alert",this.icon="information-circle-outline"):"danger"==this.type?(this.class="danger",this.icon="alert-circle-outline"):(this.class="success",this.icon="information-circle-outline")}}return(o=c).\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.VBU({type:o,selectors:[["app-info"]],inputs:{text:"text",type:"type"},decls:9,vars:3,consts:[[1,"ion-no-margin","info-item",3,"ngClass"],[1,"ion-no-padding"],["size","auto"],[1,"icon_cover"],["size","large",3,"name"],[1,"text-container"]],template:function(e,n){1&e&&(t.j41(0,"div",0)(1,"ion-grid",1)(2,"ion-row")(3,"ion-col",2)(4,"div",3),t.nrm(5,"ion-icon",4),t.k0s()(),t.j41(6,"ion-col",5),t.EFF(7),t.k0s()()(),t.nrm(8,"ion-text"),t.k0s()),2&e&&(t.Y8G("ngClass",n.class),t.R7$(5),t.Y8G("name",n.icon),t.R7$(2),t.SpI(" ",n.text," "))},dependencies:[h.MD,h.YU,u.bv,u.hU,u.lO,u.iq,u.ln,u.IO],styles:[".info-item[_ngcontent-%COMP%]{border:1px solid black;border-radius:5px;padding:15px;box-shadow:2px 2px 6px #cbcbcb;margin-top:15px}.info-item.success[_ngcontent-%COMP%]{background-color:#e4ffd6}.info-item.alert[_ngcontent-%COMP%]{background-color:#fcebd6}.info-item.danger[_ngcontent-%COMP%]{background-color:#ffdada}.text-container[_ngcontent-%COMP%]{align-self:center;margin-bottom:5px}.icon_cover[_ngcontent-%COMP%]{width:40px}"]}),c})(),B=(()=>{var o;class c{}return(o=c).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=b.G2t({imports:[u.bv,h.MD,z]}),c})(),N=(()=>{var o;class c{}return(o=c).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=b.G2t({imports:[R,h.MD,w.YN,u.bv,D,E.h,B]}),c})()}}]);